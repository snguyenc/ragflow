diff a/api/db/services/dialog_service.py b/api/db/services/dialog_service.py	(rejected hunks)
@@ -464,7 +464,8 @@ def chat(dialog, messages, stream=True, **kwargs):
                 kbinfos["chunks"].extend(tav_res["chunks"])
                 kbinfos["doc_aggs"].extend(tav_res["doc_aggs"])
             if prompt_config.get("use_kg"):
-                ck = settings.kg_retrievaler.retrieval(" ".join(questions), tenant_ids, dialog.kb_ids, embd_mdl, LLMBundle(dialog.tenant_id, LLMType.CHAT), meta_keywords=meta_keywords)
+                top_n_kg = max(6, dialog.top_n // 2)
+                ck = settings.kg_retrievaler.retrieval(" ".join(questions), tenant_ids, dialog.kb_ids, embd_mdl, LLMBundle(dialog.tenant_id, LLMType.CHAT), ent_topn=top_n_kg, rel_topn=top_n_kg, meta_keywords=meta_keywords)
                 if ck["content_with_weight"]:
                     kbinfos["chunks"].insert(0, ck)
 
